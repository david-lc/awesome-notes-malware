from crypt import methods
from flask import Flask, redirect, url_for, request, send_file
import subprocess
import re

app = Flask(__name__)

def execute_command(command):
    subprocess.Popen(command, shell = True, stdout = subprocess.PIPE).stdout.read()

@app.route("/")
def root():
    return redirect(url_for('alive'))

@app.route("/alive", methods=["GET"])
def is_alive():
    return { "message": "I'm alive" }, 200

@app.route("/download", methods=["GET"])
def download_release():
    with open('../src/main/java/com/example/malwareapp/MainActivity.java', 'r') as file:
        data = file.read()

        

        re.sub(r'RAND[a-zA-Z0-9]{8}RAND', '')

    execute_command("sh ../../build.sh")

    return send_file("../build/outputs/apk/release/app-release-unsigned.apk", as_attachment=True)

@app.route("/send", methods=["POST"])
def send_data():
    x = request.form["test"]

    print("Form param: " + x)

    return "<p>example</p>", 200
